databaseChangeLog:
  - changeSet:
      id: 20250228001
      author: devops
      comment: Add test data for development environment
      context: dev
      runAlways: true
      preConditions:
        - onFail: MARK_RAN
          sqlCheck:
            expectedResult: 0
            sql: SELECT COUNT(*) FROM template_service.template WHERE name = 'Test Template'
      changes:
        - insert:
            tableName: template
            schemaName: template_service
            columns:
              - column:
                  name: id
                  valueComputed: "uuid_generate_v4()"
              - column:
                  name: name
                  value: "Test Template"
              - column:
                  name: category_id
                  valueComputed: "(SELECT id FROM template_service.template_category WHERE name = 'Email')"
              - column:
                  name: content
                  value: |
                    <html>
                    <body class="bluecurve-body">
                      <div class="bluecurve-panel" style="max-width: 600px; margin: 0 auto; padding: 20px;">
                        <h1 class="bluecurve-title">Hello, {{.name}}!</h1>
                        <p>This is the <strong>Test Template</strong> demonstrating dynamic content generation.</p>
                        <div class="bluecurve-vars-panel" style="margin-top: 20px;">
                          <h2 class="bluecurve-subtitle">Details:</h2>
                          <ul>
                            <li><strong>Name:</strong> {{.name}}</li>
                          </ul>
                        </div>
                      </div>
                    </body>
                    </html>
              - column:
                  name: format
                  value: "html"
              - column:
                  name: version
                  value: "1"
              - column:
                  name: is_active
                  valueBoolean: true
              - column:
                  name: created_by
                  value: "system"
        - sql:
            dbms: postgresql
            sql: |
              INSERT INTO template_service.template_variable (template_id, variable_name, description, default_value, is_required)
              SELECT 
                id, 
                'name', 
                'Recipient name', 
                'User', 
                true
              FROM template_service.template 
              WHERE name = 'Test Template';
        - insert:
            tableName: template
            schemaName: template_service
            columns:
              - column:
                  name: id
                  valueComputed: "uuid_generate_v4()"
              - column:
                  name: name
                  value: "Invoice Template"
              - column:
                  name: category_id
                  valueComputed: "(SELECT id FROM template_service.template_category WHERE name = 'Report')"
              - column:
                  name: content
                  value: |
                    <html>
                    <body class="bluecurve-body p-4">
                      <h1 class="bluecurve-title">INVOICE</h1>
                      
                      <p><strong>Invoice Date:</strong> {{.date}}</p>
                      <p><strong>Invoice Number:</strong> {{.invoice_number}}</p>

                      <h2 class="bluecurve-subtitle mt-4">Customer Information</h2>
                      <p><strong>Name:</strong> {{.customer_name}}</p>
                      <p><strong>Email:</strong> {{.customer_email}}</p>

                      <h2 class="bluecurve-subtitle mt-4">Items</h2>
                      <table class="bluecurve-panel" style="width: 100%; border-collapse: collapse;">
                        <thead>
                          <tr>
                            <th style="border: 1px solid #babdb6; padding: 8px;">Item</th>
                            <th style="border: 1px solid #babdb6; padding: 8px;">Quantity</th>
                            <th style="border: 1px solid #babdb6; padding: 8px;">Price</th>
                            <th style="border: 1px solid #babdb6; padding: 8px;">Total</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr>
                            <td style="border: 1px solid #babdb6; padding: 8px;">Product A</td>
                            <td style="border: 1px solid #babdb6; padding: 8px;">2</td>
                            <td style="border: 1px solid #babdb6; padding: 8px;">$50.00</td>
                            <td style="border: 1px solid #babdb6; padding: 8px;">$100.00</td>
                          </tr>
                          <tr>
                            <td style="border: 1px solid #babdb6; padding: 8px;">Product B</td>
                            <td style="border: 1px solid #babdb6; padding: 8px;">1</td>
                            <td style="border: 1px solid #babdb6; padding: 8px;">$75.00</td>
                            <td style="border: 1px solid #babdb6; padding: 8px;">$75.00</td>
                          </tr>
                        </tbody>
                      </table>

                      <h2 class="bluecurve-subtitle mt-4">Summary</h2>
                      <p><strong>Subtotal:</strong> $175.00</p>
                      <p><strong>Tax (10%):</strong> $17.50</p>
                      <p><strong>Total:</strong> $192.50</p>
                    </body>
                    </html>
              - column:
                  name: format
                  value: "html"
              - column:
                  name: version
                  value: "1"
              - column:
                  name: is_active
                  valueBoolean: true
              - column:
                  name: created_by
                  value: "system"
        - sql:
            dbms: postgresql
            sql: |
              INSERT INTO template_service.template_variable (template_id, variable_name, description, default_value, is_required)
              SELECT 
                id, 
                'date', 
                'Invoice date', 
                '2023-01-01', 
                true
              FROM template_service.template 
              WHERE name = 'Invoice Template';
              
              INSERT INTO template_service.template_variable (template_id, variable_name, description, default_value, is_required)
              SELECT 
                id, 
                'invoice_number', 
                'Invoice number', 
                'INV-001', 
                true
              FROM template_service.template 
              WHERE name = 'Invoice Template';
              
              INSERT INTO template_service.template_variable (template_id, variable_name, description, default_value, is_required)
              SELECT 
                id, 
                'customer_name', 
                'Customer name', 
                'John Doe', 
                true
              FROM template_service.template 
              WHERE name = 'Invoice Template';
              
              INSERT INTO template_service.template_variable (template_id, variable_name, description, default_value, is_required)
              SELECT 
                id, 
                'customer_email', 
                'Customer email', 
                'john.doe@example.com', 
                true
              FROM template_service.template 
              WHERE name = 'Invoice Template';

        - insert:
            tableName: configuration
            schemaName: template_service
            columns:
              - column:
                  name: config_key
                  value: "test_mode"
              - column:
                  name: config_value
                  value: "true"
              - column:
                  name: description
                  value: "Enable test mode in development"
